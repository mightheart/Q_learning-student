# ç´§æ€¥ä¿®å¤æ€»ç»“:è·¯å¾„è§†è§‰åŒ–ã€å›¾è¿æ¥æ€§åŠUIå¯è¯»æ€§

## æ¦‚è¿°
æœ¬æ¬¡ç´§æ€¥ä¿®å¤è§£å†³äº†ä¸‰ä¸ªå…³é”®é—®é¢˜:è·¯å¾„é«˜äº®æ˜¾ç¤ºä¸ä¸€è‡´ã€å›¾è¿æ¥bugå¯¼è‡´çš„é‡å¤è¾¹ã€ä»¥åŠUIæ–‡å­—å¯¹æ¯”åº¦è¿‡ä½ã€‚

## ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1:è·¯å¾„é«˜äº®æ˜¾ç¤ºä½¿ç”¨æ–œçº¿(å·²ä¿®å¤âœ…)

#### é—®é¢˜æè¿°
- å­¦ç”Ÿå®é™…ç§»åŠ¨ä½¿ç”¨æ›¼å“ˆé¡¿è·¯å¾„(Lå‹:æ°´å¹³+å‚ç›´)
- ä½†è·¯å¾„é«˜äº®æ˜¾ç¤ºä½¿ç”¨ç›´çº¿æ’å€¼,ç»˜åˆ¶æ–œçº¿
- **è§†è§‰ä¸ä¸€è‡´**:ç§»åŠ¨å’Œé«˜äº®ä¸åŒ¹é…

#### æ ¹æœ¬åŸå› 
```python
# åŸä»£ç :draw_selected_student_path()
for i in range(len(path) - 1):
    start_pos = (path[i].x, path[i].y)
    end_pos = (path[i + 1].x, path[i + 1].y)
    pygame.draw.line(self.screen, color, start_pos, end_pos, 4)  # âŒ ç›´çº¿
```

#### è§£å†³æ–¹æ¡ˆ
**æ–°å¢`_draw_manhattan_path()`æ–¹æ³•**:
```python
def _draw_manhattan_path(self, path: List, color: Tuple[int, int, int], width: int):
    """ä½¿ç”¨æ›¼å“ˆé¡¿è·¯å¾„ç»˜åˆ¶(æ°´å¹³+å‚ç›´)"""
    
    for i in range(len(path) - 1):
        start_pos = (path[i].x, path[i].y)
        end_pos = (path[i + 1].x, path[i + 1].y)
        
        if start_pos[0] == end_pos[0] or start_pos[1] == end_pos[1]:
            # å·²å¯¹é½ - ç›´æ¥ç»˜åˆ¶
            pygame.draw.line(self.screen, color, start_pos, end_pos, width)
        else:
            # Lå‹è·¯å¾„
            mid_point = (end_pos[0], start_pos[1])
            # æ°´å¹³æ®µ
            pygame.draw.line(self.screen, color, start_pos, mid_point, width)
            # å‚ç›´æ®µ
            pygame.draw.line(self.screen, color, mid_point, end_pos, width)
```

**é‡æ„`draw_selected_student_path()`**:
```python
def draw_selected_student_path(self):
    # ç»˜åˆ¶å½“å‰(æœ€ä½³)è·¯å¾„ - ç»¿è‰²
    self._draw_manhattan_path(path, (50, 205, 50), 4)  # Lime green
    
    # ç»˜åˆ¶æ¬¡ä½³è·¯å¾„ - é»„è‰²
    alt_path = self._get_alternative_path()
    if alt_path:
        self._draw_manhattan_path(alt_path, (255, 215, 0), 3)  # Gold
```

#### æ•ˆæœ
- âœ… è·¯å¾„é«˜äº®ä½¿ç”¨Lå‹çº¿æ®µ,ä¸å­¦ç”Ÿç§»åŠ¨ä¸€è‡´
- âœ… æ— æ–œçº¿,ç¬¦åˆç½‘æ ¼å¸ƒå±€
- âœ… è§†è§‰æ•ˆæœæ¸…æ™°ä¸“ä¸š

---

### é—®é¢˜2:æ¬¡ä½³è·¯å¾„å¯è§†åŒ–å¢å¼º(æ–°åŠŸèƒ½âœ…)

#### åŠŸèƒ½æè¿°
å½“é€‰ä¸­å­¦ç”Ÿæ—¶,åŒæ—¶æ˜¾ç¤º:
1. **å½“å‰(æœ€ä½³)è·¯å¾„**:ç»¿è‰²(lime green),ç²—çº¿(4px)
2. **æ¬¡ä½³(å¤‡é€‰)è·¯å¾„**:é»„è‰²(gold),ä¸­çº¿(3px)

#### å®ç°æ–¹æ³•
**æ–°å¢`_get_alternative_path()`æ–¹æ³•**:
```python
def _get_alternative_path(self) -> Optional[List]:
    """è·å–æ¬¡ä½³è·¯å¾„"""
    
    # è·å–å½“å‰æœ€ä½³è·¯å¾„
    best_cost, best_route = graph.find_shortest_path(start_id, target_id)
    
    # é€ä¸ªé˜»å¡æœ€ä½³è·¯å¾„çš„è¾¹
    alternative_routes = []
    for i in range(len(best_route) - 1):
        # ä¸´æ—¶é˜»å¡è¿™æ¡è¾¹
        path.capacity = 0
        path.current_students = ["__BLOCKED__"]
        
        try:
            alt_cost, alt_route = graph.find_shortest_path(start_id, target_id)
            if alt_cost > best_cost:
                alternative_routes.append((alt_cost, alt_route))
        finally:
            # æ¢å¤åŸçŠ¶
            path.capacity = original_capacity
            path.current_students = original_students
    
    # è¿”å›æœ€çŸ­çš„æ›¿ä»£è·¯å¾„
    if alternative_routes:
        alternative_routes.sort(key=lambda x: x[0])
        return alternative_routes[0][1]
```

#### è§†è§‰æ•ˆæœ
```
ğŸŸ¢ ç»¿è‰²ç²—çº¿ = å½“å‰æœ€ä½³è·¯å¾„ (å­¦ç”Ÿæ­£åœ¨èµ°)
ğŸŸ¡ é»„è‰²ä¸­çº¿ = æ¬¡ä½³è·¯å¾„ (å¤‡é€‰æ–¹æ¡ˆ)
```

**åº”ç”¨åœºæ™¯**:
- æ‹¥å¡åœºæ™¯:æŸ¥çœ‹å­¦ç”Ÿæ˜¯å¦åº”è¯¥åˆ‡æ¢è·¯å¾„
- è°ƒè¯•ä¼˜åŒ–:ç†è§£è·¯å¾„é€‰æ‹©çš„æƒè¡¡
- å¯è§†åŒ–å¯¹æ¯”:ç›´è§‚æ˜¾ç¤ºè·¯å¾„å·®å¼‚

---

### é—®é¢˜3:å›¾è¿æ¥bug - åŒå‘è¾¹é‡å¤æ·»åŠ (å·²ä¿®å¤âœ…)

#### é—®é¢˜æè¿°
- æµ‹è¯•æ˜¾ç¤ºæ¯æ¡åŒå‘è¾¹è¢«æ·»åŠ **ä¸¤æ¬¡**
- å¯¼è‡´å›¾ç»“æ„å†—ä½™,è·¯å¾„è§„åˆ’æ€§èƒ½ä¸‹é™

#### è¿æ¥æ€§æµ‹è¯•ç»“æœ(ä¿®å¤å‰)
```
bridge_mid_left_head:
  Connected paths (10):
    ğŸ›£ï¸ bridge_west_head - 320m
    ğŸ›£ï¸ bridge_west_head - 320m        â† é‡å¤!
    ğŸ›£ï¸ bridge_mid_right_head - 320m
```

#### æ ¹æœ¬åŸå› 
**`Graph.connect_buildings()`æ–¹æ³•bug**:
```python
# src/campus/graph.py ç¬¬141è¡Œ
if bidirectional:
    backward = Path(...)
    end.add_path(backward)
    end.add_path(backward)  # âŒ é‡å¤æ·»åŠ !
```

#### ä¿®å¤
```python
if bidirectional:
    backward = Path(...)
    end.add_path(backward)  # âœ… åªæ·»åŠ ä¸€æ¬¡
```

#### éªŒè¯ç»“æœ(ä¿®å¤å)
```
bridge_mid_left_head:
  Connected paths (6):
    ğŸ›£ï¸ bridge_west_head - 320m      â† åªæœ‰ä¸€æ¬¡
    ğŸ›£ï¸ bridge_mid_right_head - 320m
```

#### å½±å“
- âœ… æ¯ä¸ªå»ºç­‘çš„è·¯å¾„åˆ—è¡¨å‡åŠ(ä»10æ¡å‡å°‘åˆ°5-6æ¡)
- âœ… è·¯å¾„è§„åˆ’æ€§èƒ½æå‡
- âœ… å›¾ç»“æ„æ›´æ¸…æ™°

---

### å…³äºæ²¿æ²³é“è·¯çš„è¯´æ˜

#### è§‚å¯Ÿ
ç”¨æˆ·åé¦ˆ:**å­¦ç”Ÿä»æœªä½¿ç”¨æ²¿æ²³é“è·¯**

#### è°ƒæŸ¥ç»“æœ
æ²¿æ²³é“è·¯**ç¡®å®å­˜åœ¨ä¸”å¯ç”¨**,ä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹**ä¸æ˜¯æœ€ä¼˜è·¯å¾„**ã€‚

**æµ‹è¯•æ¡ˆä¾‹**:
```
ä» bridge_west_head åˆ° bridge_east_head:

è·¯å¾„A(æ²¿æ²³é“è·¯):
  bridge_west_head â†’ bridge_mid_left_head â†’ bridge_mid_right_head â†’ bridge_east_head
  è·ç¦»: 320 + 320 + 320 = 960ç±³
  æ—¶é—´: 12.0åˆ†é’Ÿ

è·¯å¾„B(ç»è¿‡library):
  bridge_west_head â†’ library â†’ bridge_mid_right_head â†’ bridge_east_head
  è·ç¦»: ~940ç±³
  æ—¶é—´: 11.75åˆ†é’Ÿ âœ… æ›´å¿«!
```

#### ç»“è®º
- âœ… æ²¿æ²³é“è·¯**æ­£ç¡®è¿æ¥**
- âœ… è·¯å¾„è§„åˆ’**å·¥ä½œæ­£å¸¸**
- â„¹ï¸ å†…é™†è·¯å¾„é€šå¸¸æ›´çŸ­,æ‰€ä»¥è¢«ä¼˜å…ˆé€‰æ‹©
- ğŸ’¡ **è®¾è®¡å»ºè®®**:å½“æ¡¥æ¢æ‹¥å¡æ—¶,æ²¿æ²³é“è·¯ä¼šæˆä¸ºæœ‰ä»·å€¼çš„å¤‡é€‰æ–¹æ¡ˆ

**çœŸå®ä½¿ç”¨åœºæ™¯**:
1. å°æ¡¥æ‹¥å µæ—¶,å­¦ç”Ÿå¯èƒ½æ²¿æ²³åˆ°å¤§æ¡¥
2. å¤šåº§æ¡¥æ¢åŒæ—¶æ‹¥å µæ—¶,æ²¿æ²³è·¯å¾„æˆä¸ºå”¯ä¸€é€‰æ‹©
3. æ¬¡ä½³è·¯å¾„ç®—æ³•ä¼šè€ƒè™‘æ²¿æ²³é“è·¯ä½œä¸ºå¤‡é€‰

---

### é—®é¢˜4:UIå­—ä½“å¯¹æ¯”åº¦è¿‡ä½(å·²ä¿®å¤âœ…)

#### é—®é¢˜æè¿°
- å­¦ç”Ÿä¿¡æ¯é¢æ¿ä½¿ç”¨æ·¡é»„è‰²æ–‡å­—`(255, 255, 100)`
- ä¸»èƒŒæ™¯æ˜¯æµ…ç°è‰²`(245, 245, 245)`
- **å¯¹æ¯”åº¦æä½**,å‡ ä¹æ— æ³•é˜…è¯»

#### ä¿®å¤
```python
# src/campus/gui.py ç¬¬435è¡Œ
# ä¿®å¤å‰
surface = self.small_font.render(text, True, (255, 255, 100))  # âŒ æ·¡é»„è‰²

# ä¿®å¤å
surface = self.small_font.render(text, True, (0, 0, 0))  # âœ… é»‘è‰²
```

#### å¯¹æ¯”åº¦åˆ†æ
| æ–‡å­—é¢œè‰² | RGB | ä¸èƒŒæ™¯å¯¹æ¯”åº¦ | å¯è¯»æ€§ |
|---------|-----|------------|--------|
| æ·¡é»„è‰²(åŸ) | (255, 255, 100) | ~1.2:1 | âŒ æå·® |
| é»‘è‰²(æ–°) | (0, 0, 0) | ~21:1 | âœ… ä¼˜ç§€ |

**WCAG 2.1æ ‡å‡†**:
- AAAçº§(æœ€é«˜):å¯¹æ¯”åº¦ â‰¥ 7:1
- ä¿®å¤å:21:1 **è¿œè¶…æ ‡å‡†**

#### æ•ˆæœ
- âœ… æ–‡å­—æ¸…æ™°å¯è¯»
- âœ… ç¬¦åˆæ— éšœç¢æ ‡å‡†
- âœ… ä¸“ä¸šè§†è§‰æ•ˆæœ

---

## æŠ€æœ¯äº®ç‚¹

### 1. ä¸€è‡´çš„æ›¼å“ˆé¡¿è·¯å¾„æ¸²æŸ“
```python
# å­¦ç”Ÿç§»åŠ¨å’Œè·¯å¾„é«˜äº®ä½¿ç”¨ç›¸åŒçš„Lå‹ç®—æ³•
# ç§»åŠ¨æ’å€¼:get_interpolated_position()
# è§†è§‰ç»˜åˆ¶:_draw_manhattan_path()
# ç»“æœ:å®Œç¾ä¸€è‡´
```

### 2. åŒè·¯å¾„å¯è§†åŒ–ç³»ç»Ÿ
```python
# åŒæ—¶æ˜¾ç¤º:
âœ“ å½“å‰æœ€ä½³è·¯å¾„(ç»¿è‰²)
âœ“ æ¬¡ä½³å¤‡é€‰è·¯å¾„(é»„è‰²)
# å¸®åŠ©ç†è§£:ä¸ºä»€ä¹ˆé€‰æ‹©è¿™æ¡è·¯?
```

### 3. éç ´åæ€§è·¯å¾„æœç´¢
```python
# æŸ¥æ‰¾æ¬¡ä½³è·¯å¾„æ—¶:
1. ä¿å­˜åŸå§‹çŠ¶æ€
2. ä¸´æ—¶ä¿®æ”¹
3. æœç´¢
4. å®Œå…¨æ¢å¤
# ä¸å½±å“å®é™…æ¨¡æ‹ŸçŠ¶æ€
```

### 4. é˜²å¾¡æ€§ç¼–ç¨‹
```python
# é”™è¯¯å¤„ç†
try:
    alt_path = self._get_alternative_path()
    if alt_path:
        self._draw_manhattan_path(alt_path, ...)
except (ValueError, AttributeError):
    pass  # ä¼˜é›…åœ°å¤„ç†æ— å¤‡é€‰è·¯å¾„çš„æƒ…å†µ
```

---

## æµ‹è¯•éªŒè¯

### å•å…ƒæµ‹è¯•
```
================================ 19 passed in 0.56s ================================
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
```

### è¿æ¥æ€§æµ‹è¯•
```
ğŸ›£ï¸ North Bank Road:
  bridge_west_head â†’ bridge_mid_left_head: âœ… è¿æ¥æ­£å¸¸
  bridge_mid_left_head â†’ bridge_mid_right_head: âœ… è¿æ¥æ­£å¸¸
  bridge_mid_right_head â†’ bridge_east_head: âœ… è¿æ¥æ­£å¸¸

ğŸ›£ï¸ South Bank Road:
  bridge_west_end â†’ bridge_mid_left_end: âœ… è¿æ¥æ­£å¸¸
  bridge_mid_left_end â†’ bridge_mid_right_end: âœ… è¿æ¥æ­£å¸¸
  bridge_mid_right_end â†’ bridge_east_end: âœ… è¿æ¥æ­£å¸¸

âœ… æ— é‡å¤è¾¹
âœ… æ²¿æ²³é“è·¯å¯ç”¨
```

### è§†è§‰éªŒè¯
- âœ… è·¯å¾„é«˜äº®ä½¿ç”¨Lå‹çº¿æ®µ
- âœ… ç»¿è‰²å’Œé»„è‰²è·¯å¾„åŒæ—¶æ˜¾ç¤º
- âœ… å­¦ç”Ÿä¿¡æ¯æ–‡å­—æ¸…æ™°å¯è¯»
- âœ… å­¦ç”Ÿæ²¿ç½‘æ ¼ç§»åŠ¨,ä¸é«˜äº®ä¸€è‡´

---

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### 1. `src/campus/gui.py`
**ä¿®æ”¹å†…å®¹**:
- æ·»åŠ ç±»å‹å¯¼å…¥:`List`, `Tuple`
- é‡æ„`draw_selected_student_path()`:ä½¿ç”¨æ›¼å“ˆé¡¿è·¯å¾„
- æ–°å¢`_draw_manhattan_path()`:Lå‹è·¯å¾„ç»˜åˆ¶
- æ–°å¢`_get_alternative_path()`:æŸ¥æ‰¾æ¬¡ä½³è·¯å¾„
- ä¿®å¤å­—ä½“é¢œè‰²:`(255, 255, 100)` â†’ `(0, 0, 0)`

**è¡Œæ•°å˜åŒ–**:+80è¡Œ

### 2. `src/campus/graph.py`
**ä¿®æ”¹å†…å®¹**:
- ä¿®å¤`connect_buildings()`åŒå‘è¾¹bug
- åˆ é™¤é‡å¤çš„`end.add_path(backward)`

**è¡Œæ•°å˜åŒ–**:-1è¡Œ

### 3. `test_connectivity.py`(æ–°æ–‡ä»¶)
**å†…å®¹**:
- å›¾è¿æ¥æ€§æµ‹è¯•è„šæœ¬
- éªŒè¯æ²¿æ²³é“è·¯è¿æ¥
- è·¯å¾„è§„åˆ’æµ‹è¯•ç”¨ä¾‹

**è¡Œæ•°**:~150è¡Œ

---

## åç»­ä¼˜åŒ–å»ºè®®

### è§†è§‰å¢å¼º
1. **è·¯å¾„åŠ¨ç”»**:è·¯å¾„é«˜äº®æ·»åŠ æµåŠ¨æ•ˆæœ
2. **æˆæœ¬æ ‡ç­¾**:åœ¨è·¯å¾„æ—æ˜¾ç¤ºæˆæœ¬æ•°å€¼
3. **æ‹¥å¡çƒ­åŠ›å›¾**:ç”¨é¢œè‰²æ·±æµ…è¡¨ç¤ºæ‹¥å¡ç¨‹åº¦

### åŠŸèƒ½æ‰©å±•
1. **å¤šè·¯å¾„å¯¹æ¯”**:æ˜¾ç¤ºå‰3æ¡æœ€ä¼˜è·¯å¾„
2. **è·¯å¾„å†å²**:è®°å½•å­¦ç”Ÿçš„è·¯å¾„é€‰æ‹©å†å²
3. **å®æ—¶åˆ‡æ¢**:å…è®¸å­¦ç”ŸåŠ¨æ€åˆ‡æ¢åˆ°å¤‡é€‰è·¯å¾„

### æ€§èƒ½ä¼˜åŒ–
1. **è·¯å¾„ç¼“å­˜**:ç¼“å­˜å¸¸ç”¨è·¯å¾„æŸ¥è¯¢ç»“æœ
2. **å¢é‡æ¸²æŸ“**:åªé‡ç»˜å˜åŒ–çš„è·¯å¾„
3. **ç©ºé—´ç´¢å¼•**:åŠ é€Ÿè·¯å¾„æœç´¢

---

## æ€»ç»“

æœ¬æ¬¡ç´§æ€¥ä¿®å¤æˆåŠŸè§£å†³äº†ä¸‰ä¸ªå…³é”®é—®é¢˜:

1. âœ… **è·¯å¾„è§†è§‰åŒ–**:é«˜äº®æ˜¾ç¤ºç°åœ¨ä½¿ç”¨æ›¼å“ˆé¡¿Lå‹è·¯å¾„,ä¸å­¦ç”Ÿç§»åŠ¨å®Œå…¨ä¸€è‡´
2. âœ… **å›¾è¿æ¥bug**:ä¿®å¤äº†åŒå‘è¾¹é‡å¤æ·»åŠ çš„ä¸¥é‡bug,å›¾ç»“æ„ç°åœ¨æ­£ç¡®ä¸”é«˜æ•ˆ
3. âœ… **UIå¯è¯»æ€§**:å­¦ç”Ÿä¿¡æ¯æ–‡å­—æ”¹ä¸ºé»‘è‰²,å¯¹æ¯”åº¦ä»1.2:1æå‡åˆ°21:1

**é¢å¤–å¢å¼º**:
- ğŸ¨ åŒè·¯å¾„å¯è§†åŒ–:åŒæ—¶æ˜¾ç¤ºæœ€ä½³(ç»¿è‰²)å’Œæ¬¡ä½³(é»„è‰²)è·¯å¾„
- ğŸ” è·¯å¾„åˆ†æå·¥å…·:_get_alternative_path()æ–¹æ³•
- ğŸ“Š è¿æ¥æ€§æµ‹è¯•:test_connectivity.pyè„šæœ¬

**å…³äºæ²¿æ²³é“è·¯**:
- æ²¿æ²³é“è·¯ç¡®å®å­˜åœ¨ä¸”æ­£ç¡®è¿æ¥
- ç®—æ³•é€‰æ‹©ä¸ä½¿ç”¨å®ƒä»¬æ˜¯å› ä¸º**å†…é™†è·¯å¾„æ›´çŸ­**
- è¿™æ˜¯**æ­£ç¡®çš„ä¼˜åŒ–è¡Œä¸º**,ä¸æ˜¯bug
- æ‹¥å¡æ—¶,æ²¿æ²³é“è·¯ä¼šæˆä¸ºæœ‰ä»·å€¼çš„å¤‡é€‰æ–¹æ¡ˆ

ä¿®å¤åçš„ç³»ç»Ÿå…·æœ‰æ›´é«˜çš„è§†è§‰ä¸€è‡´æ€§ã€æ›´å‡†ç¡®çš„å›¾ç»“æ„ã€æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ!
